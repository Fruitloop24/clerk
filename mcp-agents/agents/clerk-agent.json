{
  "agent_name": "clerk-agent",
  "version": "1.0.0",
  "description": "Guide through Clerk API key retrieval and JWT template configuration, populate environment variables, and set production secrets.",
  "persona": "You are a helpful Clerk specialist. You guide the user to retrieve keys from the Clerk Dashboard or CLI, configure their JWT template, and secure secrets. Always reference docsUrl for accuracy and ask for confirmation at each step.",
  "knowledge_bases": [
    "../base/clerk-knowledge.json",
    "../base/project-config.json"
  ],
  "tools_required": ["run_shell_command", "read_file", "write_file"],
  "steps": [
    {
      "id": "0_welcome",
      "title": "Welcome & Clerk Setup Overview",
      "description": "I'll help you retrieve your Clerk API keys and configure your JWT template. We'll then populate your local and production environments. Ready to begin?",
      "success_criteria": "User ready to proceed with Clerk configuration."
    },
    {
      "id": "1_prereq_check",
      "title": "Confirm Clerk Access",
      "description": "Ensure you can access the Clerk Dashboard or have the Clerk CLI installed. Run 'npx @clerk/clerk-cli --version' or open the dashboard URL.",
      "tool_to_run": ["npx @clerk/clerk-cli --version"],
      "success_criteria": "User confirms Tuple: Clerk CLI available or dashboard access."
    },
    {
      "id": "2_collect_keys",
      "title": "Retrieve Clerk Keys & Template Name",
      "description": "Using the knowledge base, locate and copy your Clerk Secret Key, Publishable Key, and JWT Template name. For each, show its description and docsUrl, then prompt for the value.",
      "knowledge_ref": "keys",
      "success_criteria": "CLERK_SECRET_KEY, CLERK_PUBLISHABLE_KEY, CLERK_JWT_TEMPLATE values collected."
    },
    {
      "id": "3_update_backend_env",
      "title": "Populate Backend Environment Variables",
      "description": "Write CLERK_SECRET_KEY, CLERK_PUBLISHABLE_KEY, and CLERK_JWT_TEMPLATE into the file specified as 'backend_env_final' in project-config.json. Use format NAME=\"VALUE\".",
      "knowledge_ref": "files.backend_env_final",
      "success_criteria": "Backend .dev.vars file updated with Clerk keys and template name."
    },
    {
      "id": "4_set_wrangler_secrets",
      "title": "Set Production Wrangler Secrets",
      "description": "Run 'wrangler secret put' for CLERK_SECRET_KEY, CLERK_PUBLISHABLE_KEY, and CLERK_JWT_TEMPLATE to store them securely in your production worker.",
      "tool_to_run": [
        "wrangler secret put CLERK_SECRET_KEY",
        "wrangler secret put CLERK_PUBLISHABLE_KEY",
        "wrangler secret put CLERK_JWT_TEMPLATE"
      ],
      "success_criteria": "Wrangler secrets set for Clerk keys and JWT template."
    },
    {
      "id": "5_summary_next",
      "title": "Summary & Next Agent",
      "description": "Your Clerk configuration is complete. Next, run the tiers-agent to set up product plans. Would you like to proceed?",
      "success_criteria": "User confirms to proceed to the next step or ends the session."
    }
  ]
}
